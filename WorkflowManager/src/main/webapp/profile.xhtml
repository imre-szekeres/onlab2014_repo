<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:h="http://java.sun.com/jsf/html">

	<ui:composition template="WEB-INF/templates/wm_frame.xhtml">
	
	   <ui:define name='content_title'>
	       #{ sessionScope.subject.username }
	   </ui:define>
	   
	   <ui:define name='content'>
	       #{ loginManager.profileSetup() }
	       <h:form id='pro-form' prependId="false" >
		       <h:inputHidden value='#{ loginManager.subjectId }' immediate='true' id='sudject-in' />
		       
		       <h:panelGrid columns='1'  cellspacing='1' cellpadding='2' id='profile-grid'  >
		           
		           <h:message for='username' styleClass='error-message profile-grid' />
		           <h:panelGrid columns='2' styleClass='profile-grid' >
		               <h:outputText value='Username: ' />
	                   <h:outputText value='#{ loginManager.username }' name='username' id='username' />
		           </h:panelGrid>
		           
		           <h:message for='old_password' styleClass='error-message profile-grid' />
		           <h:message for='new_password' styleClass='error-message profile-grid' />
		           <h:panelGrid columns='2' id='chpass-panel' styleClass='profile-grid' >
		               <h:outputText value='Old Password: ' />
	                   <h:inputSecret value='#{ loginManager.oldPassword }' name='old_password' id='old_password' 
	                            validator='#{ loginManager.validateOldPassword }'  />
		               
		               <h:outputText value='New Password: ' />
	                   <h:inputSecret value='#{ loginManager.newPassword }' name='new_password' id='new_password' 
	                            validator='#{ loginManager.validateNewPassword }'  />   
		           </h:panelGrid>
		           
		           <h:message for='email'       styleClass='error-message profile-grid' />
		           <h:message for='description' styleClass='error-message profile-grid' />
		           <h:panelGrid columns='2' styleClass='profile-grid'>
		               <h:outputText value='Email: ' />
		               <h:inputText value='#{ loginManager.email }' name='email' id='email' 
		                            validator='#{ loginManager.validateEmailIn }'/>
		               
		               <h:outputText value='Description: ' />
		               <h:inputTextarea value='#{ loginManager.description }' name='description' id='description' 
	                                    validator='#{ loginManager.validateDescriptionIn }' size='100' />
		           </h:panelGrid>
		           
	               <h:panelGrid columns='2' id='submit-panel' styleClass='profile-grid'>
	                   <h:commandButton type='submit' value='Submit' id='submit-btn' action='#{ loginManager.modify }' />
	                   <h:commandButton type='button' value='Cancel' id='cancel-btn' />
	               </h:panelGrid>
	               
	               <h:panelGrid columns='2' id='modif-panel' styleClass='profile-grid'>
		               <h:commandButton type="button" id='modify-btn' styleClass='cvf-btn' style='width:100%;' value='Modify'></h:commandButton>
		               <h:commandButton type='button' id='chpass-btn' styleClass='cvf-btn' style='width:100%;' value='Change Password'></h:commandButton>               
	               </h:panelGrid>
	               
		       </h:panelGrid>
		       
		       <h:dataTable value="#{ sessionScope.subject.roles }" var='role' title='Roles for #{ sessionScope.subject.username }'>
	               <h:column>
	                   <f:facet name='header'>Role</f:facet>
	                   <h:outputText value='#{ role }' />
	               </h:column>
	           </h:dataTable>
	       </h:form>
	       
	       <h:outputScript>
	           var submit_pnl = $("#submit-panel");
	           var chpass_pnl = $("#chpass-panel");
	           var modif_pnl  = $("#modif-panel");
	       
	           function onCancel( event ) {
	               $("input[type!='button'][type!='submit'],textarea").prop( 'disabled',true );
	               chpass_pnl.hide();
                   submit_pnl.hide();
                   modif_pnl.show();
	           }
	       
	           function startPassChange() {
	               $("input[type='password']").prop( 'disabled',false );
	               modif_pnl.hide();
                   chpass_pnl.show();
                   submit_pnl.show();
	           }
	       
	           function startModify() {
	               $("input,textarea").prop( 'disabled',false );
	               modif_pnl.hide();
	               submit_pnl.show();
	           }
	       
	           onCancel();
	           $("#modify-btn").click( startModify );
	           $("#chpass-btn").click( startPassChange );
	           $("#cancel-btn").click( onCancel );
	           $('#subject-in').hide();
	       </h:outputScript>
	   </ui:define>
	   
	</ui:composition>
</html>