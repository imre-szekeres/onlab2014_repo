<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:c='http://java.sun.com/jstl/core'>

	<ui:composition template="WEB-INF/templates/wm_frame.xhtml">
	   <ui:define name='content_title'>
	       #{ sessionScope.subject.username }
	   </ui:define>
	   <ui:define name='content'>
	   
	       <h:form id='pro-form' prependId="false" >
		       <h:panelGrid columns='1'  cellspacing='1' cellpadding='2' id='profile-grid' >
		           <h:panelGrid columns='2'>
		               <h:outputText value='Username: ' />
	                   <h:inputText value='#{ loginManager.subject.username }' name='username' disabled="true"
	                            validator='#{ loginManager.validateUsernameIn }'  />
		           </h:panelGrid>
		           
		           <div id='chpass-panel-div'>
		           <h:panelGrid columns='2' id='chpass-panel' >
		               <h:outputText value='Old Password: ' />
	                   <h:inputSecret value='#{ loginManager.subject.password }' name='old_password' disabled="true"
	                            validator='#{ loginManager.validateOldPassword }'  />
		               
		               <h:outputText value='New Password: ' />
	                   <h:inputSecret value='#{ loginManager.subject.password }' name='new_password' disabled="true"
	                            validator='#{ loginManager.validatePasswordIn }'  />
	                      
		           </h:panelGrid>
		           </div>
		           
		           <h:panelGrid columns='2'>
		               <h:outputText value='Email: ' />
		               <h:inputText value='#{ sessionScope.subject.email }' name='email' disabled="true"  id='email-in'
		                            validator='#{ loginManager.validateEmailIn }'/>
		               
		               <h:outputText value='Description: ' />
		               <h:inputTextarea value='#{ sessionScope.subject.description }' name='description' disabled="true" size='50'
	                                validator='#{ loginManager.validateDescriptionIn }' />
		           </h:panelGrid>
		           
	               <h:panelGrid columns='2' id='submit-panel'>
	                   <h:commandButton action='#{ loginManager.modify(sessionScope.subject) }' value='Submit' id='submit-btn' />
	                   <h:commandButton type='button' value='Cancel' id='cancel-btn' />
	               </h:panelGrid>
	               
	               <h:panelGrid columns='2' id='modif-panel'>
		               <h:commandButton type="button" id='modify-btn' styleClass='cvf-btn' style='width:100%;' value='Modify'></h:commandButton>
		               <h:commandButton type='button' id='chpass-btn' styleClass='cvf-btn' style='width:100%;' value='Change Password'></h:commandButton>               
	               </h:panelGrid>
	               
		       </h:panelGrid>
		       
		       <h:dataTable value="#{ sessionScope.subject.roles }" var='role' title='Roles for #{ sessionScope.subject.username }'>
	               <h:column>
	                   <f:facet name='header'>Role</f:facet>
	                   <h:outputText value='#{ role }' />
	               </h:column>
	           </h:dataTable>
	       </h:form>
	       
	       <h:outputScript>
	           var submit_pnl = $("#submit-panel");
	           var chpass_pnl = $("#chpass-panel");
	           var modif_pnl  = $("#modif-panel");
	       
	           function onCancel() {
	               $("input[type!='button'],textarea").prop( 'disabled',true );
	               chpass_pnl.hide();
                   submit_pnl.hide();
                   modif_pnl.show();
	           }
	       
	           function startPassChange() {
	               $("input[type='password']").prop( 'disabled',false );
	               $("#submit-btn").prop( 'disabled',false );
	               modif_pnl.hide();
                   chpass_pnl.show();
                   submit_pnl.show();
	           }
	       
	           function startModify() {
	               $("input,textarea").prop( 'disabled',false );
	               modif_pnl.hide();
	               submit_pnl.show();
	           }
	       
	           onCancel();
	           $("#modify-btn").click( startModify );
	           $("#chpass-btn").click( startPassChange );
	           $("#cancel-btn").click( onCancel );
	       </h:outputScript>
	   </ui:define>
	</ui:composition>
</html>